<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¤å…é…ç½®å‘å¯¼ - Restaurant Configuration Wizard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .wizard-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .wizard-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .wizard-header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .wizard-header p {
            color: #666;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #667eea;
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .help-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #333;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #e1e8ed;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: "ğŸª";
            margin-right: 10px;
            font-size: 1.2em;
        }

        .section-title.website::before { content: "ğŸŒ"; }
        .section-title.currency::before { content: "ğŸ’°"; }
        .section-title.business::before { content: "âš™ï¸"; }
        .section-title.security::before { content: "ğŸ”"; }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            justify-content: center;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e1e8ed;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #dee2e6;
        }

        .preview-section {
            background: #f8f9fa;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }

        .preview-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .preview-title::before {
            content: "ğŸ‘ï¸";
            margin-right: 10px;
        }

        .config-preview {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
        }

        .success-message, .error-message {
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            font-weight: 600;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .wizard-container {
                padding: 20px;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="wizard-container">
        <div class="wizard-header">
            <h1>ğŸª é¤å…é…ç½®å‘å¯¼</h1>
            <p>Restaurant Configuration Wizard</p>
            <p style="margin-top: 10px; font-size: 0.95em;">å¿«é€Ÿé…ç½®æ–°é¤å…çš„ç®¡ç†ç³»ç»Ÿå‚æ•°</p>
        </div>

        <form id="configForm">
            <div class="section-title">åŸºæœ¬ä¿¡æ¯</div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="restaurantId">é¤å…ID *</label>
                    <input type="text" id="restaurantId" name="restaurantId" placeholder="ä¾‹å¦‚: NewRestaurant" required>
                    <div class="help-text">ç”¨äºæ•°æ®åº“è·¯å¾„å’Œå†…éƒ¨æ ‡è¯†ï¼Œå»ºè®®ä½¿ç”¨è‹±æ–‡æ— ç©ºæ ¼</div>
                </div>
                
                <div class="form-group">
                    <label for="displayName">é¤å…æ˜¾ç¤ºåç§° *</label>
                    <input type="text" id="displayName" name="displayName" placeholder="ä¾‹å¦‚: æ–°é¤å…åç§°" required>
                    <div class="help-text">åœ¨ç®¡ç†ç•Œé¢ä¸­æ˜¾ç¤ºçš„é¤å…åç§°</div>
                </div>
            </div>

            <div class="form-group">
                <label for="systemTitle">ç®¡ç†ç³»ç»Ÿæ ‡é¢˜</label>
                <input type="text" id="systemTitle" name="systemTitle" placeholder="ä¾‹å¦‚: æ–°é¤å… é¤å…ç®¡ç†ç³»ç»Ÿ">
                <div class="help-text">ç®¡ç†ç•Œé¢æ ‡é¢˜æ æ˜¾ç¤ºçš„æ–‡å­—</div>
            </div>

            <div class="section-title website">ç½‘ç«™é…ç½®</div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="baseUrl">ç½‘ç«™åŸºç¡€URL *</label>
                    <input type="url" id="baseUrl" name="baseUrl" placeholder="ä¾‹å¦‚: https://newrestaurant.web.app" required>
                    <div class="help-text">å®¢æˆ·è®¿é—®çš„ç½‘ç«™åœ°å€</div>
                </div>
                
                <div class="form-group">
                    <label for="domain">åŸŸå</label>
                    <input type="text" id="domain" name="domain" placeholder="ä¾‹å¦‚: newrestaurant.web.app">
                    <div class="help-text">ä¸åŒ…å«åè®®çš„çº¯åŸŸå</div>
                </div>
            </div>

            <div class="section-title currency">è´§å¸è®¾ç½®</div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="currency">è´§å¸ç¬¦å· *</label>
                    <input type="text" id="currency" name="currency" placeholder="ä¾‹å¦‚: â‚¬ æˆ– $ æˆ– Â¥" value="â‚¬" required>
                    <div class="help-text">åœ¨ä»·æ ¼æ˜¾ç¤ºä¸­ä½¿ç”¨çš„è´§å¸ç¬¦å·</div>
                </div>
                
                <div class="form-group">
                    <label for="currencyPosition">è´§å¸ä½ç½®</label>
                    <select id="currencyPosition" name="currencyPosition">
                        <option value="before">ç¬¦å·åœ¨å‰ (â‚¬10.00)</option>
                        <option value="after">ç¬¦å·åœ¨å (10.00â‚¬)</option>
                    </select>
                </div>
            </div>

            <div class="section-title business">ä¸šåŠ¡è®¾ç½®</div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="defaultMaxTime">é»˜è®¤ç”¨é¤æ—¶é•¿ (åˆ†é’Ÿ)</label>
                    <input type="number" id="defaultMaxTime" name="defaultMaxTime" placeholder="120" value="120" min="30" max="300">
                    <div class="help-text">å®¢æˆ·çš„é»˜è®¤ç”¨é¤æ—¶é—´é™åˆ¶</div>
                </div>
                
                <div class="form-group">
                    <label for="defaultRoundTime">è®¡æ—¶è½®æ¬¡ (åˆ†é’Ÿ)</label>
                    <input type="number" id="defaultRoundTime" name="defaultRoundTime" placeholder="15" value="15" min="5" max="60">
                    <div class="help-text">è®¡æ—¶ç³»ç»Ÿçš„è½®æ¬¡é—´éš”</div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="defaultFoodLimit">é£Ÿç‰©é™åˆ¶æ•°é‡</label>
                    <input type="number" id="defaultFoodLimit" name="defaultFoodLimit" placeholder="4" value="4" min="1" max="20">
                    <div class="help-text">å®¢æˆ·å¯é€‰æ‹©çš„é£Ÿç‰©é¡¹ç›®æ•°é‡é™åˆ¶</div>
                </div>
                
                <div class="form-group">
                    <label for="defaultDessertLimit">ç”œç‚¹é™åˆ¶æ•°é‡</label>
                    <input type="number" id="defaultDessertLimit" name="defaultDessertLimit" placeholder="2" value="2" min="1" max="10">
                    <div class="help-text">å®¢æˆ·å¯é€‰æ‹©çš„ç”œç‚¹é¡¹ç›®æ•°é‡é™åˆ¶</div>
                </div>
            </div>

            <div class="form-group">
                <label for="tablePrefix">æ¡Œå°å‰ç¼€</label>
                <input type="text" id="tablePrefix" name="tablePrefix" placeholder="ä¾‹å¦‚: Tafel æˆ– Table" value="Tafel">
                <div class="help-text">æ•°æ®åº“ä¸­æ¡Œå°é”®åçš„å‰ç¼€ (å¦‚ "Tafel-1")</div>
            </div>

            <div class="section-title security">å®‰å…¨è®¾ç½®</div>
            
            <div class="form-group">
                <label for="defaultAdminPassword">é»˜è®¤ç®¡ç†å‘˜å¯†ç </label>
                <input type="text" id="defaultAdminPassword" name="defaultAdminPassword" placeholder="ä¾‹å¦‚: 1234" value="7788">
                <div class="help-text">ç®¡ç†ç•Œé¢çš„é»˜è®¤ç™»å½•å¯†ç </div>
            </div>
            
            <div class="form-group">
                <label for="whatsappRecipients">WhatsApp æ¥æ”¶å·ç </label>
                <textarea id="whatsappRecipients" name="whatsappRecipients" rows="3" placeholder="æ¯è¡Œä¸€ä¸ªå·ç ï¼Œä¾‹å¦‚:&#10;31619971032&#10;31683560665"></textarea>
                <div class="help-text">æ¥æ”¶é€šçŸ¥çš„WhatsAppå·ç ï¼Œæ¯è¡Œä¸€ä¸ª</div>
            </div>

            <div class="button-group">
                <button type="button" class="btn btn-secondary" onclick="generatePreview()">
                    ğŸ‘ï¸ é¢„è§ˆé…ç½®
                </button>
                <button type="button" class="btn btn-primary" onclick="generateConfig()">
                    ğŸ’¾ ç”Ÿæˆé…ç½®æ–‡ä»¶
                </button>
            </div>
        </form>

        <div id="previewSection" class="preview-section" style="display: none;">
            <div class="preview-title">é…ç½®æ–‡ä»¶é¢„è§ˆ</div>
            <div class="config-preview" id="configPreview"></div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button type="button" class="btn btn-secondary" onclick="copyConfig()">
                    ğŸ“‹ å¤åˆ¶é…ç½®
                </button>
                <button type="button" class="btn btn-primary" onclick="downloadConfig()">
                    ğŸ’¾ ä¸‹è½½é…ç½®æ–‡ä»¶
                </button>
            </div>
        </div>

        <div id="messageArea"></div>
    </div>

    <script>
        // è‡ªåŠ¨å¡«å……åŸŸå
        document.getElementById('baseUrl').addEventListener('input', function(e) {
            const url = e.target.value;
            const domainField = document.getElementById('domain');
            if (url && !domainField.value) {
                try {
                    const urlObj = new URL(url);
                    domainField.value = urlObj.hostname;
                } catch (e) {
                    // å¿½ç•¥æ— æ•ˆURLé”™è¯¯
                }
            }
        });

        // è‡ªåŠ¨ç”Ÿæˆç³»ç»Ÿæ ‡é¢˜
        document.getElementById('displayName').addEventListener('input', function(e) {
            const displayName = e.target.value;
            const systemTitleField = document.getElementById('systemTitle');
            if (displayName && !systemTitleField.value) {
                systemTitleField.value = `${displayName} é¤å…ç®¡ç†ç³»ç»Ÿ`;
            }
        });

        function getFormData() {
            const form = document.getElementById('configForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value.trim();
            }
            
            // å¤„ç†WhatsAppå·ç 
            if (data.whatsappRecipients) {
                data.whatsappRecipients = data.whatsappRecipients
                    .split('\n')
                    .map(num => num.trim())
                    .filter(num => num.length > 0);
            } else {
                data.whatsappRecipients = [];
            }
            
            // è®¾ç½®é»˜è®¤å€¼
            if (!data.systemTitle) data.systemTitle = `${data.displayName} é¤å…ç®¡ç†ç³»ç»Ÿ`;
            if (!data.domain && data.baseUrl) {
                try {
                    data.domain = new URL(data.baseUrl).hostname;
                } catch (e) {}
            }
            
            return data;
        }

        function validateForm(data) {
            const errors = [];
            
            if (!data.restaurantId) errors.push('é¤å…IDæ˜¯å¿…å¡«çš„');
            if (!data.displayName) errors.push('é¤å…æ˜¾ç¤ºåç§°æ˜¯å¿…å¡«çš„');
            if (!data.baseUrl) errors.push('ç½‘ç«™åŸºç¡€URLæ˜¯å¿…å¡«çš„');
            if (!data.currency) errors.push('è´§å¸ç¬¦å·æ˜¯å¿…å¡«çš„');
            
            // æ£€æŸ¥é¤å…IDæ ¼å¼
            if (data.restaurantId && !/^[a-zA-Z][a-zA-Z0-9_-]*$/.test(data.restaurantId)) {
                errors.push('é¤å…IDåº”ä»¥å­—æ¯å¼€å¤´ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦');
            }
            
            // æ£€æŸ¥URLæ ¼å¼
            if (data.baseUrl) {
                try {
                    new URL(data.baseUrl);
                } catch (e) {
                    errors.push('ç½‘ç«™åŸºç¡€URLæ ¼å¼ä¸æ­£ç¡®');
                }
            }
            
            return errors;
        }

        function generateConfigObject(data) {
            return {
                restaurantId: data.restaurantId,
                restaurantPath: data.restaurantId,
                displayName: data.displayName,
                systemTitle: data.systemTitle,
                baseUrl: data.baseUrl,
                domain: data.domain,
                currency: data.currency,
                currencyPosition: data.currencyPosition || 'before',
                defaultMaxTime: parseInt(data.defaultMaxTime) || 120,
                defaultFoodLimit: parseInt(data.defaultFoodLimit) || 4,
                defaultDessertLimit: parseInt(data.defaultDessertLimit) || 2,
                defaultRoundTime: parseInt(data.defaultRoundTime) || 15,
                defaultAdminPassword: data.defaultAdminPassword || '7788',
                defaultWhatsappEnabled: data.whatsappRecipients.length > 0,
                defaultTimeLimitEnabled: true,
                defaultWhatsappRecipients: data.whatsappRecipients,
                tablePrefix: data.tablePrefix || 'Tafel',
                firebaseConfig: {}
            };
        }

        function generateConfigFileContent(configObj) {
            return `// æ–°é¤å…é…ç½® - ${configObj.displayName}
// è‡ªåŠ¨ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}

// å°†æ­¤é…ç½®æ·»åŠ åˆ° restaurant-config.js çš„ RESTAURANT_CONFIGS å¯¹è±¡ä¸­
'${configObj.restaurantId}': {
    // åŸºç¡€ä¿¡æ¯ - Basic Information
    restaurantId: '${configObj.restaurantId}',
    restaurantPath: '${configObj.restaurantPath}', // Firebaseæ•°æ®åº“è·¯å¾„
    displayName: '${configObj.displayName}',
    systemTitle: '${configObj.systemTitle}',
    
    // ç½‘ç«™é…ç½® - Website Configuration
    baseUrl: '${configObj.baseUrl}',
    domain: '${configObj.domain}',
    
    // è´§å¸è®¾ç½® - Currency Settings
    currency: '${configObj.currency}',
    currencyPosition: '${configObj.currencyPosition}', // 'before' or 'after'
    
    // é»˜è®¤ä¸šåŠ¡è®¾ç½® - Default Business Settings
    defaultMaxTime: ${configObj.defaultMaxTime}, // åˆ†é’Ÿ - minutes
    defaultFoodLimit: ${configObj.defaultFoodLimit},
    defaultDessertLimit: ${configObj.defaultDessertLimit},
    defaultRoundTime: ${configObj.defaultRoundTime}, // è®¡æ—¶è½®æ¬¡åˆ†é’Ÿæ•° - minutes for timing rounds
    defaultAdminPassword: '${configObj.defaultAdminPassword}', // é»˜è®¤ç®¡ç†å‘˜å¯†ç 
    defaultWhatsappEnabled: ${configObj.defaultWhatsappEnabled}, // WhatsAppæ¶ˆæ¯åŠŸèƒ½
    defaultTimeLimitEnabled: true, // æ—¶é—´é™åˆ¶åŠŸèƒ½
    defaultWhatsappRecipients: [${configObj.defaultWhatsappRecipients.map(num => `'${num}'`).join(', ')}], // WhatsAppæ¥æ”¶è€…
    
    // æ¡Œå°é…ç½® - Table Configuration  
    tablePrefix: '${configObj.tablePrefix}', // æ•°æ®åº“é”®å‰ç¼€ (å¦‚ "Tafel-1")
    
    // Firebaseé…ç½® - Firebase Configuration
    firebaseConfig: {
        // å¦‚æœéœ€è¦ä¸åŒé¤å…ä½¿ç”¨ä¸åŒFirebaseé¡¹ç›®ï¼Œåœ¨è¿™é‡Œé…ç½®
        // å¦åˆ™ä½¿ç”¨å…¨å±€Firebaseé…ç½®
    }
},

// éƒ¨ç½²è¯´æ˜:
// 1. å°†ä¸Šè¿°é…ç½®å¤åˆ¶åˆ° restaurant-config.js çš„ RESTAURANT_CONFIGS å¯¹è±¡ä¸­
// 2. ä¿®æ”¹ CURRENT_RESTAURANT ä¸º '${configObj.restaurantId}'
// 3. ç¡®ä¿Firebaseæ•°æ®åº“ä¸­æœ‰å¯¹åº”çš„ '${configObj.restaurantPath}' è·¯å¾„
// 4. éƒ¨ç½²åˆ°æœåŠ¡å™¨å¹¶æµ‹è¯•åŠŸèƒ½`;
        }

        function showMessage(message, type = 'success') {
            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = `<div class="${type}-message">${message}</div>`;
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }

        function generatePreview() {
            const data = getFormData();
            const errors = validateForm(data);
            
            if (errors.length > 0) {
                showMessage('è¯·ä¿®å¤ä»¥ä¸‹é”™è¯¯:<br>' + errors.map(err => `â€¢ ${err}`).join('<br>'), 'error');
                return;
            }
            
            const configObj = generateConfigObject(data);
            const configContent = generateConfigFileContent(configObj);
            
            document.getElementById('configPreview').textContent = configContent;
            document.getElementById('previewSection').style.display = 'block';
            
            document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generateConfig() {
            const data = getFormData();
            const errors = validateForm(data);
            
            if (errors.length > 0) {
                showMessage('è¯·ä¿®å¤ä»¥ä¸‹é”™è¯¯:<br>' + errors.map(err => `â€¢ ${err}`).join('<br>'), 'error');
                return;
            }
            
            generatePreview();
            showMessage(`âœ… é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ! é¤å…ID: ${data.restaurantId}`);
        }

        function copyConfig() {
            const configContent = document.getElementById('configPreview').textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(configContent).then(() => {
                    showMessage('âœ… é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿!');
                }).catch(err => {
                    fallbackCopy(configContent);
                });
            } else {
                fallbackCopy(configContent);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                showMessage('âœ… é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿!');
            } catch (err) {
                showMessage('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é…ç½®å†…å®¹', 'error');
            }
            
            document.body.removeChild(textArea);
        }

        function downloadConfig() {
            const data = getFormData();
            const configObj = generateConfigObject(data);
            const configContent = generateConfigFileContent(configObj);
            
            const blob = new Blob([configContent], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${data.restaurantId}-config.js`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage(`âœ… é…ç½®æ–‡ä»¶å·²ä¸‹è½½: ${data.restaurantId}-config.js`);
        }
    </script>
</body>
</html>